<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investment Dashboard - Standalone</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
        .login-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; }
        .login-form { background: white; border-radius: 12px; padding: 40px; max-width: 400px; width: 100%; }
        .form-input { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #e1e5e9; border-radius: 6px; }
        .login-button { width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 14px; border-radius: 6px; cursor: pointer; font-size: 16px; }
        .App { text-align: center; }
        .App-header { background-color: #282c34; padding: 20px; color: white; min-height: 80vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .error { color: red; margin: 10px 0; }
        .logout-btn { position: absolute; top: 20px; right: 20px; background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // Simple authentication context
        const useAuth = () => {
            const [isAuthenticated, setIsAuthenticated] = useState(() => {
                return localStorage.getItem('authToken') === 'demo-token';
            });
            
            const login = (email, password) => {
                if (email === 'admin@example.com' && password === 'password123') {
                    localStorage.setItem('authToken', 'demo-token');
                    setIsAuthenticated(true);
                    return { success: true };
                }
                return { success: false, error: 'Invalid credentials' };
            };
            
            const logout = () => {
                localStorage.removeItem('authToken');
                setIsAuthenticated(false);
            };
            
            return { isAuthenticated, login, logout };
        };

        // Login Component
        const Login = ({ onLogin }) => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            
            const handleSubmit = (e) => {
                e.preventDefault();
                const result = onLogin(email, password);
                if (!result.success) {
                    setError(result.error);
                }
            };
            
            return (
                <div className="login-container">
                    <form className="login-form" onSubmit={handleSubmit}>
                        <h2>Welcome Back</h2>
                        {error && <div className="error">{error}</div>}
                        <input
                            type="email"
                            placeholder="Email (admin@example.com)"
                            value={email}
                            onChange={(e) => setEmail(e.target.value)}
                            className="form-input"
                            required
                        />
                        <input
                            type="password"
                            placeholder="Password (password123)"
                            value={password}
                            onChange={(e) => setPassword(e.target.value)}
                            className="form-input"
                            required
                        />
                        <button type="submit" className="login-button">Sign In</button>
                        <div style={{marginTop: '20px', fontSize: '12px', color: '#666'}}>
                            <p><strong>Demo Credentials:</strong></p>
                            <p>Email: admin@example.com</p>
                            <p>Password: password123</p>
                        </div>
                    </form>
                </div>
            );
        };

        // Investment Dashboard Component
        const InvestmentDashboard = ({ onLogout }) => {
            const [ticker, setTicker] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            const handleDownload = async (endpoint, filename) => {
                if (!ticker.trim()) {
                    setError('Please enter a ticker symbol');
                    return;
                }
                
                setLoading(true);
                setError('');
                
                try {
                    const response = await axios({
                        method: 'POST',
                        url: `http://localhost:5000/api/${endpoint}`,
                        responseType: 'blob',
                        data: { ticker: ticker.toUpperCase() }
                    });
                    
                    const url = window.URL.createObjectURL(new Blob([response.data]));
                    const link = document.createElement('a');
                    link.href = url;
                    link.setAttribute('download', `${filename}_${ticker.toUpperCase()}_${Date.now()}.csv`);
                    document.body.appendChild(link);
                    link.click();
                    link.parentNode.removeChild(link);
                    window.URL.revokeObjectURL(url);
                } catch (err) {
                    setError('Failed to download CSV. Make sure the backend is running on localhost:5000');
                    console.error('Error:', err);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="App">
                    <button className="logout-btn" onClick={onLogout}>Logout</button>
                    <header className="App-header">
                        <h1>Key Metrics Dashboard</h1>
                        
                        <div style={{width: '100%', maxWidth: '600px'}}>
                            <div style={{margin: '20px 0'}}>
                                <label htmlFor="ticker">Stock Ticker Symbol:</label>
                                <input
                                    id="ticker"
                                    type="text"
                                    value={ticker}
                                    onChange={(e) => setTicker(e.target.value)}
                                    placeholder="e.g., AAPL, MSFT, GOOGL"
                                    disabled={loading}
                                    style={{margin: '10px', padding: '10px', fontSize: '16px'}}
                                />
                            </div>

                            <div style={{display: 'flex', flexDirection: 'column', gap: '10px', maxWidth: '400px', margin: '0 auto'}}>
                                <button 
                                    onClick={() => handleDownload('debt-to-equity-csv', 'debt_to_equity')} 
                                    disabled={loading || !ticker.trim()}
                                    style={{padding: '15px', fontSize: '16px', cursor: 'pointer'}}
                                >
                                    {loading ? 'Generating...' : 'Download Debt-to-Equity CSV'}
                                </button>
                                
                                <button 
                                    onClick={() => handleDownload('cash-flow-csv', 'cash_flow')} 
                                    disabled={loading || !ticker.trim()}
                                    style={{padding: '15px', fontSize: '16px', cursor: 'pointer'}}
                                >
                                    {loading ? 'Generating...' : 'Download Cash Flow CSV'}
                                </button>
                                
                                <button 
                                    onClick={() => handleDownload('cash-earnings-growth-csv', 'Earnings_Growth')} 
                                    disabled={loading || !ticker.trim()}
                                    style={{padding: '15px', fontSize: '16px', cursor: 'pointer'}}
                                >
                                    {loading ? 'Generating...' : 'Download Cash Earnings Growth CSV'}
                                </button>
                                
                                <button 
                                    onClick={() => handleDownload('roe-csv', 'ROE')} 
                                    disabled={loading || !ticker.trim()}
                                    style={{padding: '15px', fontSize: '16px', cursor: 'pointer'}}
                                >
                                    {loading ? 'Generating...' : 'Download ROE CSV'}
                                </button>
                            </div>

                            {error && <p className="error">{error}</p>}
                        </div>
                        
                        <div style={{marginTop: '40px', textAlign: 'left', maxWidth: '800px'}}>
                            <h2>Peter Lynch</h2>
                            <p>
                                Peter Lynch is a legendary American investor and former mutual fund manager, 
                                best known for managing the Fidelity Magellan Fund from 1977 to 1990. 
                                During his tenure, he achieved an extraordinary average annual return of 29.2%, 
                                making Magellan the best-performing mutual fund in the world and growing its 
                                assets from $18 million to $14 billion.
                            </p>
                            <p>
                                In this project we have tried to use some principles from his book 
                                "One Up On Wall Street" in order to take better decisions while investing in stocks.
                            </p>
                        </div>
                    </header>
                </div>
            );
        };

        // Main App Component
        const App = () => {
            const { isAuthenticated, login, logout } = useAuth();

            if (!isAuthenticated) {
                return <Login onLogin={login} />;
            }

            return <InvestmentDashboard onLogout={logout} />;
        };

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>